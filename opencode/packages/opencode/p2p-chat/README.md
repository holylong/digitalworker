# 局域网P2P聊天工具

一个基于Node.js和TypeScript的局域网点对点聊天工具，无需中央服务器即可实现多用户聊天。

## 功能特性

- 🔍 **自动发现**: 使用UDP广播自动发现局域网内的其他用户
- 💬 **点对点通信**: 基于TCP的直接消息传输
- 🎨 **友好界面**: 使用Clack提供的现代化TUI界面
- 🔄 **实时通信**: 支持实时消息发送和接收
- 📱 **多用户**: 支持多用户同时在线聊天

## 安装依赖

```bash
bun install
```

## 使用方法

### 启动聊天工具

```bash
# 使用默认用户名启动
bun start

# 指定用户名启动
bun start "Alice"
```

### 使用界面

1. 启动后输入你的用户名
2. 使用方向键选择操作：
   - 👥 查看在线用户
   - 💬 发送消息
   - 📜 查看消息历史
   - 🚪 退出

### 发送消息

1. 选择"💬 发送消息"
2. 从在线用户列表中选择接收者
3. 输入消息内容
4. 消息将直接发送给目标用户

## 技术实现

### 网络架构

- **UDP广播 (端口30000)**: 用于用户发现和保持在线状态
- **TCP通信 (端口30001)**: 用于点对点消息传输

### 核心组件

- `PeerDiscovery`: UDP广播发现机制
- `ChatServer/ChatClient`: TCP通信服务
- `ChatUI`: 用户界面
- `P2PChat`: 主控制器

### 协议格式

```typescript
interface Message {
  type: "discovery" | "chat"
  username: string
  port: number
  timestamp: number
  data?: any
}
```

## 开发命令

```bash
# 开发模式（热重载）
bun run dev

# 类型检查
bun run typecheck

# 构建
bun run build
```

## 注意事项

- 确保所有设备在同一局域网内
- 防火墙可能需要允许UDP 30000和TCP 30001端口
- 用户名建议使用英文字符，避免编码问题

## 故障排除

### 无法发现其他用户

1. 检查设备是否在同一局域网
2. 检查防火墙设置
3. 确认UDP 30000端口未被占用

### 消息发送失败

1. 检查目标用户是否在线
2. 确认TCP 30001端口未被占用
3. 检查网络连接状态

## 开发环境

- Node.js 18+
- Bun 运行时
- TypeScript 5.3+
- 支持 ESM 模块
