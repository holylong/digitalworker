<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é«˜æ¸…3Dåœ°çƒä»ª - çœŸå®çº¹ç†</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: radial-gradient(ellipse at center, #0a0e27 0%, #000000 100%);
        overflow: hidden;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      #canvas-container {
        width: 100%;
        height: 100%;
        position: relative;
      }

      #info {
        position: absolute;
        top: 20px;
        left: 20px;
        color: white;
        z-index: 100;
        background: rgba(0, 0, 0, 0.7);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        max-width: 300px;
      }

      #info h1 {
        margin-bottom: 10px;
        font-size: 28px;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        background: linear-gradient(45deg, #00ff88, #00aaff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      #info p {
        font-size: 14px;
        opacity: 0.9;
        line-height: 1.6;
        margin-bottom: 8px;
      }

      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 20px;
        z-index: 1000;
        text-align: center;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid #00ff88;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .controls {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
        z-index: 100;
        flex-wrap: wrap;
        justify-content: center;
      }

      button {
        padding: 12px 24px;
        background: linear-gradient(45deg, rgba(0, 255, 136, 0.1), rgba(0, 170, 255, 0.1));
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: 500;
      }

      button:hover {
        background: linear-gradient(45deg, rgba(0, 255, 136, 0.2), rgba(0, 170, 255, 0.2));
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
      }

      button:active {
        transform: scale(0.95);
      }

      .texture-info {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        z-index: 100;
        background: rgba(0, 0, 0, 0.5);
        padding: 15px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
        font-size: 12px;
        max-width: 200px;
      }

      .texture-info h3 {
        margin-bottom: 8px;
        font-size: 14px;
        color: #00ff88;
      }

      .stats {
        position: absolute;
        bottom: 20px;
        left: 20px;
        color: white;
        z-index: 100;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
        font-size: 12px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div class="loading-spinner"></div>
      <div>åŠ è½½é«˜æ¸…åœ°çƒçº¹ç†ä¸­...</div>
      <div style="font-size: 14px; opacity: 0.7; margin-top: 10px">è¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</div>
    </div>

    <div id="info">
      <h1>ğŸŒ é«˜æ¸…3Dåœ°çƒä»ª</h1>
      <p>ğŸ–±ï¸ é¼ æ ‡æ‹–æ‹½æ—‹è½¬</p>
      <p>âš¡ æ»šè½®ç¼©æ”¾</p>
      <p>ğŸ“± æ”¯æŒè§¦æ‘¸æ“ä½œ</p>
      <p>ğŸ¨ çœŸå®NASAçº¹ç†</p>
    </div>

    <div id="canvas-container"></div>

    <div class="texture-info">
      <h3>çº¹ç†æ¥æº</h3>
      <p>â€¢ åœ°çƒè¡¨é¢: NASA Blue Marble</p>
      <p>â€¢ å¤œæ™¯ç¯å…‰: NASA Earth City Lights</p>
      <p>â€¢ äº‘å±‚: çœŸå®å«æ˜Ÿæ•°æ®</p>
      <p>â€¢ åœ°å½¢: NASA SRTM</p>
    </div>

    <div class="controls">
      <button id="toggleRotation">æš‚åœæ—‹è½¬</button>
      <button id="resetView">é‡ç½®è§†è§’</button>
      <button id="toggleWireframe">åˆ‡æ¢çº¿æ¡†</button>
      <button id="toggleClouds">åˆ‡æ¢äº‘å±‚</button>
      <button id="toggleNight">æ—¥å¤œåˆ‡æ¢</button>
    </div>

    <div class="stats" id="stats">FPS: <span id="fps">60</span> | å¤šè¾¹å½¢: <span id="polygons">8K</span></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      let scene, camera, renderer, earth, atmosphere, clouds, nightLights
      let isRotating = true
      let isWireframe = false
      let showClouds = true
      let showNight = false
      let frameCount = 0
      let lastTime = performance.now()

      // ä½¿ç”¨å¯é çš„é«˜æ¸…çº¹ç†CDN
      const EARTH_DAY_TEXTURE =
        "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/planets/earth_atmos_2048.jpg"
      const EARTH_NIGHT_TEXTURE =
        "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/planets/earth_lights_2048.jpg"
      const EARTH_CLOUD_TEXTURE =
        "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/planets/earth_clouds_1024.jpg"
      const EARTH_NORMAL_TEXTURE =
        "https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/textures/planets/earth_normal_2048.jpg"

      const textureLoader = new THREE.TextureLoader()

      function init() {
        // åˆ›å»ºåœºæ™¯
        scene = new THREE.Scene()

        // åˆ›å»ºç›¸æœº
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000)
        camera.position.z = 4

        // åˆ›å»ºæ¸²æŸ“å™¨
        renderer = new THREE.WebGLRenderer({
          antialias: true,
          alpha: true,
          powerPreference: "high-performance",
        })
        renderer.setSize(window.innerWidth, window.innerHeight)
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
        renderer.shadowMap.enabled = true
        renderer.shadowMap.type = THREE.PCFSoftShadowMap
        renderer.toneMapping = THREE.ACESFilmicToneMapping
        renderer.toneMappingExposure = 1.2

        document.getElementById("canvas-container").appendChild(renderer.domElement)

        // åˆ›å»ºåœ°çƒå‡ ä½•ä½“ï¼ˆé«˜ç»†èŠ‚ï¼‰
        const earthGeometry = new THREE.SphereGeometry(1, 128, 128)

        // åˆ›å»ºåœ°çƒæè´¨
        const earthMaterial = new THREE.MeshPhongMaterial({
          map: textureLoader.load(EARTH_DAY_TEXTURE, () => {
            console.log("åœ°çƒæ—¥é—´çº¹ç†åŠ è½½å®Œæˆ")
          }),
          normalMap: textureLoader.load(EARTH_NORMAL_TEXTURE, () => {
            console.log("åœ°çƒæ³•çº¿è´´å›¾åŠ è½½å®Œæˆ")
          }),
          normalScale: new THREE.Vector2(0.1, 0.1),
          shininess: 20,
          wireframe: false,
        })

        // åˆ›å»ºåœ°çƒç½‘æ ¼
        earth = new THREE.Mesh(earthGeometry, earthMaterial)
        earth.castShadow = true
        earth.receiveShadow = true
        scene.add(earth)

        // åˆ›å»ºå¤œæ™¯ç¯å…‰å±‚
        const nightGeometry = new THREE.SphereGeometry(1.01, 128, 128)
        const nightMaterial = new THREE.MeshBasicMaterial({
          map: textureLoader.load(EARTH_NIGHT_TEXTURE, () => {
            console.log("åœ°çƒå¤œæ™¯çº¹ç†åŠ è½½å®Œæˆ")
          }),
          transparent: true,
          opacity: 0,
          blending: THREE.AdditiveBlending,
        })

        nightLights = new THREE.Mesh(nightGeometry, nightMaterial)
        earth.add(nightLights)

        // åˆ›å»ºäº‘å±‚
        const cloudGeometry = new THREE.SphereGeometry(1.02, 128, 128)
        const cloudMaterial = new THREE.MeshPhongMaterial({
          map: textureLoader.load(EARTH_CLOUD_TEXTURE, () => {
            console.log("äº‘å±‚çº¹ç†åŠ è½½å®Œæˆ")
          }),
          transparent: true,
          opacity: 0.3,
          depthWrite: false,
        })

        clouds = new THREE.Mesh(cloudGeometry, cloudMaterial)
        scene.add(clouds)

        // åˆ›å»ºå¤§æ°”å±‚
        const atmosphereGeometry = new THREE.SphereGeometry(1.15, 64, 64)
        const atmosphereMaterial = new THREE.ShaderMaterial({
          uniforms: {
            c: { value: 0.5 },
            p: { value: 3.0 },
          },
          vertexShader: `
                    varying vec3 vNormal;
                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
          fragmentShader: `
                    uniform float c;
                    uniform float p;
                    varying vec3 vNormal;
                    void main() {
                        float intensity = pow(c - dot(vNormal, vec3(0.0, 0.0, 1.0)), p);
                        gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity;
                    }
                `,
          side: THREE.BackSide,
          transparent: true,
          blending: THREE.AdditiveBlending,
        })

        atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial)
        scene.add(atmosphere)

        // æ·»åŠ å…‰ç…§ç³»ç»Ÿ
        const ambientLight = new THREE.AmbientLight(0x404040, 0.3)
        scene.add(ambientLight)

        const sunLight = new THREE.DirectionalLight(0xffffff, 2)
        sunLight.position.set(5, 3, 5)
        sunLight.castShadow = true
        sunLight.shadow.mapSize.width = 4096
        sunLight.shadow.mapSize.height = 4096
        sunLight.shadow.camera.near = 0.1
        sunLight.shadow.camera.far = 50
        scene.add(sunLight)

        const moonLight = new THREE.DirectionalLight(0x88ccff, 0.3)
        moonLight.position.set(-5, -3, -5)
        scene.add(moonLight)

        // æ·»åŠ æ˜Ÿç©ºèƒŒæ™¯
        addStars()

        // æ·»åŠ é¼ æ ‡æ§åˆ¶
        addControls()

        // éšè—åŠ è½½æç¤º
        document.getElementById("loading").style.display = "none"
      }

      function addStars() {
        const starsGeometry = new THREE.BufferGeometry()
        const starsMaterial = new THREE.PointsMaterial({
          color: 0xffffff,
          size: 0.02,
          transparent: true,
          opacity: 0.9,
          sizeAttenuation: true,
        })

        const starsVertices = []
        const starsColors = []

        for (let i = 0; i < 20000; i++) {
          const x = (Math.random() - 0.5) * 2000
          const y = (Math.random() - 0.5) * 2000
          const z = (Math.random() - 0.5) * 2000
          starsVertices.push(x, y, z)

          // æ·»åŠ æ˜Ÿæ˜Ÿé¢œè‰²å˜åŒ–
          const color = new THREE.Color()
          const hue = Math.random()
          const saturation = Math.random() * 0.5
          const lightness = 0.5 + Math.random() * 0.5
          color.setHSL(hue, saturation, lightness)
          starsColors.push(color.r, color.g, color.b)
        }

        starsGeometry.setAttribute("position", new THREE.Float32BufferAttribute(starsVertices, 3))
        starsGeometry.setAttribute("color", new THREE.Float32BufferAttribute(starsColors, 3))

        const starsMaterial2 = new THREE.PointsMaterial({
          size: 0.02,
          vertexColors: true,
          transparent: true,
          opacity: 0.9,
          sizeAttenuation: true,
        })

        const stars = new THREE.Points(starsGeometry, starsMaterial2)
        scene.add(stars)
      }

      function addControls() {
        let isMouseDown = false
        let mouseX = 0
        let mouseY = 0
        let targetRotationX = 0
        let targetRotationY = 0
        let mouseRotationX = 0
        let mouseRotationY = 0

        renderer.domElement.addEventListener("mousedown", (event) => {
          isMouseDown = true
          mouseX = event.clientX
          mouseY = event.clientY
        })

        renderer.domElement.addEventListener("mouseup", () => {
          isMouseDown = false
        })

        renderer.domElement.addEventListener("mousemove", (event) => {
          if (!isMouseDown) return

          const deltaX = event.clientX - mouseX
          const deltaY = event.clientY - mouseY

          mouseRotationY += deltaX * 0.008
          mouseRotationX += deltaY * 0.008

          mouseX = event.clientX
          mouseY = event.clientY
        })

        renderer.domElement.addEventListener("wheel", (event) => {
          event.preventDefault()
          camera.position.z += event.deltaY * 0.002
          camera.position.z = Math.max(2, Math.min(8, camera.position.z))
        })

        // è§¦æ‘¸äº‹ä»¶æ”¯æŒ
        let touchStartX = 0
        let touchStartY = 0

        renderer.domElement.addEventListener("touchstart", (event) => {
          touchStartX = event.touches[0].clientX
          touchStartY = event.touches[0].clientY
        })

        renderer.domElement.addEventListener("touchmove", (event) => {
          event.preventDefault()
          const deltaX = event.touches[0].clientX - touchStartX
          const deltaY = event.touches[0].clientY - touchStartY

          mouseRotationY += deltaX * 0.01
          mouseRotationX += deltaY * 0.01

          touchStartX = event.touches[0].clientX
          touchStartY = event.touches[0].clientY
        })

        // å¹³æ»‘æ—‹è½¬æ›´æ–°
        function updateMouseRotation() {
          targetRotationX += (mouseRotationX - targetRotationX) * 0.1
          targetRotationY += (mouseRotationY - targetRotationY) * 0.1

          if (!isRotating) {
            earth.rotation.x = targetRotationX
            earth.rotation.y = targetRotationY
            clouds.rotation.x = targetRotationX
            clouds.rotation.y = targetRotationY
            atmosphere.rotation.x = targetRotationX
            atmosphere.rotation.y = targetRotationY
          }

          requestAnimationFrame(updateMouseRotation)
        }
        updateMouseRotation()
      }

      function updateStats() {
        frameCount++
        const currentTime = performance.now()

        if (currentTime >= lastTime + 1000) {
          const fps = Math.round((frameCount * 1000) / (currentTime - lastTime))
          document.getElementById("fps").textContent = fps
          frameCount = 0
          lastTime = currentTime
        }

        requestAnimationFrame(updateStats)
      }

      function animate() {
        requestAnimationFrame(animate)

        // è‡ªåŠ¨æ—‹è½¬
        if (isRotating) {
          earth.rotation.y += 0.002
          clouds.rotation.y += 0.003
          atmosphere.rotation.y += 0.001
        }

        renderer.render(scene, camera)
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight
        camera.updateProjectionMatrix()
        renderer.setSize(window.innerWidth, window.innerHeight)
      }

      // äº‹ä»¶ç›‘å¬å™¨
      window.addEventListener("resize", onWindowResize)

      document.getElementById("toggleRotation").addEventListener("click", function () {
        isRotating = !isRotating
        this.textContent = isRotating ? "æš‚åœæ—‹è½¬" : "å¼€å§‹æ—‹è½¬"
      })

      document.getElementById("resetView").addEventListener("click", function () {
        camera.position.set(0, 0, 4)
        earth.rotation.set(0, 0, 0)
        clouds.rotation.set(0, 0, 0)
        atmosphere.rotation.set(0, 0, 0)
      })

      document.getElementById("toggleWireframe").addEventListener("click", function () {
        isWireframe = !isWireframe
        earth.material.wireframe = isWireframe
        this.textContent = isWireframe ? "åˆ‡æ¢å®ä½“" : "åˆ‡æ¢çº¿æ¡†"
      })

      document.getElementById("toggleClouds").addEventListener("click", function () {
        showClouds = !showClouds
        clouds.visible = showClouds
        this.textContent = showClouds ? "éšè—äº‘å±‚" : "æ˜¾ç¤ºäº‘å±‚"
      })

      document.getElementById("toggleNight").addEventListener("click", function () {
        showNight = !showNight

        if (showNight) {
          // åˆ‡æ¢åˆ°å¤œæ™¯æ¨¡å¼
          earth.material.map = textureLoader.load(EARTH_NIGHT_TEXTURE)
          nightLights.opacity = 0.8
          scene.fog = new THREE.Fog(0x000000, 1, 15)
        } else {
          // åˆ‡æ¢å›æ—¥é—´æ¨¡å¼
          earth.material.map = textureLoader.load(EARTH_DAY_TEXTURE)
          nightLights.opacity = 0
          scene.fog = null
        }

        earth.material.needsUpdate = true
        this.textContent = showNight ? "åˆ‡æ¢æ—¥é—´" : "åˆ‡æ¢å¤œæ™¯"
      })

      // åˆå§‹åŒ–å’Œå¼€å§‹åŠ¨ç”»
      init()
      animate()
      updateStats()
    </script>
  </body>
</html>
